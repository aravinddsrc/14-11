@model DSRCManagementSystem.Models.PaymentStructure
@{
    ViewBag.Title = "Create Task";
    Layout = null;
}
<!Doctype html>
<html>
    <head>
    <meta name="viewport" content="width=device-width" />
    <title>Create Task</title>

    <link href="../../Content/Template/js/jquery-ui/css/no-theme/jquery-ui-1.10.3.custom.min.css" rel="stylesheet" type="text/css" />
    <link href="../../Content/Template/css/font-icons/entypo/css/entypo.css" rel="stylesheet" type="text/css" />
    <script src="../../Content/Template/js/select2/select2.min.js" type="text/javascript"></script>
    <link href="../../Content/Template/js/select2/select2-bootstrap.css" rel="stylesheet" type="text/css" />
    <link href="../../Content/Template/js/select2/select2.css" rel="stylesheet" type="text/css" />
    <script src="../../Content/Template/js/toastr.js" type="text/javascript"></script>
    <script src="../../Content/JS/ToasterAlert.js" type="text/javascript"></script>
    <script src="../../Content/Template/js/bootstrap-datepicker.js" type="text/javascript"></script>

         <style>
        .dropdown-menu {
    background-color: white;
}
        </style>

    </head>
    <body>
       
    <div class="modal-content">
        <div class="modal-header" style="background-color: #f0f0f1;">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                ×</button>
            <h4 class="modal-title">
                Update Payment Status</h4>
        </div>
        <div class="modal-body">
            @using (Html.BeginForm("UpdatePayment", "PaymentStructure"))
            {  
                <div class="row">
                    <div class="col-md-12" style="text-align: right">
                        @Html.Label("*", new { @style = "color:#FF0000" }) Required field(s)
                    </div>
                </div>
                
                   <div class="row">
                    <div class="col-md-6">
                      <div class="form-group">
                         @Html.Label("Customer Name", new { @class = "control-label" })    
                         @Html.TextBoxFor(x => x.UserName, new { @id = "UserName", @name = "UserName", @class = "form-control", @style = "height:45px", @readonly = "readonly" })                                                                      
                          <span id="span_Desc" style="color: Red;"></span>    
                      </div>
                      </div>
                        <div class="col-md-6">
                      <div class="form-group">
                         @Html.Label("Branch",(string)ViewBag.Lbl_branch, new { @class = "control-label" })   
                        @Html.TextBoxFor(x => x.Branch, new { @id = "Branch", @name = "Branch", @class = "form-control", @style = "height:45px", @readonly = "readonly" })                                                                         
                      </div>
                      </div>
                   </div>
                 <div class="row">
                    <div class="col-md-6">
                      <div class="form-group">
                         @Html.Label("Department Name",(string)ViewBag.Lbl_department, new { @class = "control-label" })     
                          @Html.TextBoxFor(x => x.Department, new { @id = "Department", @name = "Department", @class = "form-control", @style = "height:45px", @readonly = "readonly" })                                                                        
                      </div>
                      </div>
                        <div class="col-md-6">
                      <div class="form-group">
                         @Html.Label("Group",(string)ViewBag.Lbl_depgroup , new { @class = "control-label" })   
                          @Html.TextBoxFor(x => x.Group, new { @id = "Group", @name = "Group", @class = "form-control", @style = "height:45px", @readonly = "readonly" })                                                                       
                      </div>
                      </div>
                   </div>
                  <div class="row">
                    <div class="col-md-6">
                      <div class="form-group">
                         @Html.Label("Due Date", new { @class = "control-label" })     
                          @Html.TextBoxFor(x => x.DueDate, new {Value=Model.DueDate.ToString("dd-MM-yyyy"), @id = "DueDate", @name = "DueDate", @class = "form-control", @style = "height:45px", @readonly = "readonly" })                                                                        
                      </div>
                      </div>
                        <div class="col-md-6">
                      <div class="form-group">
                            @Html.Label("Payment Type", new {@class = "control-label"})
                            @Html.TextBoxFor(x => x.PaymentType, new {@id = "PaymentType", @name = "PaymentType", @class = "form-control", @style = "height:45px", @readonly = "readonly"})
                      </div>
                      </div>
                   </div>
                 <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                             @Html.Label("Amount", new { @class = "control-label" })   
                          @Html.TextBoxFor(x => x.Amount, new { @id = "Amount", @name = "Amount", @class = "form-control", @style = "height:45px", @readonly = "readonly" })
                        </div>
                      </div>
                        <div class="col-md-6">
                      <div class="form-group">
                         @Html.Label("Status", new { @class = "control-label" }) 
                         @Html.Label(" *", new { @class = "control-label", @style="color:red" })   
                         @Html.DropDownListFor(x => x.StatusID, new SelectList(ViewBag.StatusList, "StatusID", "PaymentStatus"), new{@id = "ActionID", @class = "form-control"})
                      </div>
                      </div>
                   </div>
                  <div class="row" id="paydiv">
                    <div class="col-md-6">
                      <div class="form-group">
                          @Html.Label("Amount Paid", new {@class = "control-label"})
                          @Html.Label(" *", new { @class = "control-label", @style="color:red" })   
                          @Html.TextBoxFor(x => x.PaidAmount, new { @id = "PaidAmount", @name = "PaidAmount", @class = "form-control", @style = "height:45px" })
                          <span id="span_amountpaid" style="color: red"></span> 
                           <span id="span_amounterror" style="color:red"></span>                                                                                               
                      </div>
                      </div>
                        <div class="col-md-6">
                      <div class="form-group">
                         @Html.Label("Pending", new { @class = "control-label" })   
                          @Html.TextBoxFor(x => x.PendingAmount, new { @id = "Pending", @name = "Pending", @class = "form-control", @style = "height:45px",@readonly="readonly" })                                                                       
                      </div>
                      </div>
                   </div>
                  <div class="row">
                    <div class="col-md-12">
                      <div class="form-group">
                         @Html.Label("Comments ", new { @class = "control-label" })  
                          @Html.TextAreaFor(x => x.comments, new { @id = "comments", @name = "comments", @class = "form-control", @style = "height:70px", @maxlength = 100 })                                                                      
                          </div>
                      </div>
                </div>
            }
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">
                Cancel
            </button>
            <button type="button" id="btnAdd" class="btn btn-info" onclick="Updatestatus(@ViewBag.PaymentId,@ViewBag.PaymentTermId)">
                Save
            </button>

        </div>
    </div>
      <script type="text/javascript">
          $(function () {

              $(".modal-body select").select2({
                  //minimumResultsForSearch: -1
              });

              $("#ReportingUsers").select2();
          });
          $("#PaidAmount").change(function () {
              var totalamount = parseInt ($("#Amount").val());
              var amount = parseInt($("#PaidAmount").val());
              $("#Pending").val(totalamount - amount);
          });
          $("#PaidAmount").on('paste keypress', (function (e) {
              var key;
              if (e.which) {
                  key = String.fromCharCode(e.which);
              } else {
                  key = e.originalEvent.clipboardData.getData('Text');
              }
              var value = $(this).val() + key;
              if (!/^[0-9.]{1,999}$/.test(value)) {
                  e.preventDefault();
              }
          }));
          $(document).ready(function () {

              $('#paydiv').hide();

          });
          $("#ActionID").change(function () {
              var totalamount = parseInt($("#Amount").val());
              if ($(this).val() == "1")
                  {
                  $('#paydiv').show();
                  $("#PaidAmount").val(totalamount);
                  $("#Pending").val("0");
                  }
              if ($(this).val() == "2")
                  {
                  $('#paydiv').hide();
                  $("#PaidAmount").val('');
                  $("#Pending").val('');
                  }
              if ($(this).val() == "3")
                  {
                  $('#paydiv').show();
                  $("#PaidAmount").val('');
                  $("#Pending").val('');
                  }
              if ($(this).val() == "4")
                  {
                  $('#paydiv').hide();
                  $("#PaidAmount").val('');
                  $("#Pending").val('');
                  }

          });
        var opts = {
            "closeButton": true,
            "debug": false,
            "positionClass": "toast-top-right",
            "onclick": null,
            "showDuration": "300",
            "hideDuration": "1000",
            "timeOut": "2000",
            "extendedTimeOut": "1000",
            "showEasing": "swing",
            "hideEasing": "linear",
            "showMethod": "fadeIn",
            "hideMethod": "fadeOut"
        };
        function Updatestatus(PaymentId, PaymentTermId) {
            var value = {
                "PaymentID": PaymentId,
                "PaymentTermID": PaymentTermId,
                "StatusID": $("#ActionID").val(),
                "comments": $("#comments").val(),
                "PaidAmount": $("#PaidAmount").val(),
                "PendingAmount": $("#Pending").val(),
                "CustomerName":$('#UserName').val()
            };
            var pay = $('#ActionID').val();
            var paid =parseInt ($('#PaidAmount').val());
            var amount = parseInt($('#Amount').val());
              if (pay == "1" || pay == "3")
                {
                  if (paid == "" || paid > amount ||isNaN(paid))
                  {
                        if (paid == "" || isNaN(paid))
                            document.getElementById('span_amountpaid').innerHTML = "Enter Paid Amount";
                        else
                            document.getElementById('span_amountpaid').innerHTML = "";
                        if(paid>amount)
                            document.getElementById('span_amountpaid').innerHTML = "Paid Amount should not be greater than Amount";
                        else
                            document.getElementById('span_amounterror').innerHTML = "";
                    }
                    else {

                        $.ajax({
                            url: "../../PaymentStructure/UpdatePayment/",
                            type: 'POST', cache: false,
                            data: value,
                            success: function (result) {
                                if (result == "success") {
                                    toastr.success("Payment Status Updated Successfully", opts);
                                    $("#portlet-config").modal('hide');
                                    setTimeout(function () { window.location = window.location; }, 1000);
                                }
                                else {
                                    toastr.warning("Payment Status Updation Failed", opts);
                                    $("#portlet-config").modal('hide');
                                    setTimeout(function () { window.location = window.location; }, 1000);
                                }
                            }

                        });
                
                    }
            }
            if (pay == "2" || pay == "4") {
                $.ajax({
                    url: "../../PaymentStructure/UpdatePayment/",
                    type: 'POST', cache: false,
                    data: value,
                    success: function (result) {
                        if (result == "success") {
                            toastr.success("Payment Status Updated Successfully", opts);
                            $("#portlet-config").modal('hide');
                            setTimeout(function () { window.location = window.location; }, 1000);
                        }
                        else {
                            toastr.warning("Payment Status Updation Failed", opts);
                            $("#portlet-config").modal('hide');
                            setTimeout(function () { window.location = window.location; }, 1000);
                        }
                    }

                });
                
            }
          
            }

    </script>
   
    </body>
</html>